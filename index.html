<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Visual Aim Calculator</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="mobile-selectors">
    <img src="Armor.png" id="armor" class="mobile" title="Armor" />
    <img src="Mage.png" id="mage" class="mobile" title="Mage" />
    <img src="Raon.png" id="raon" class="mobile" title="Raon" />
    <img src="Asate.png" id="asate" class="mobile" title="Asate" />
  </div>

  <div class="bfr" id="bfr">
    <div class="bfr-fill" id="bfr-fill"></div>
  </div>

  <div class="info-panel" id="info-panel">
    <div>Mobile Selecionado: <span id="selected-mobile">Armor</span></div>
    <div>Força Corrigida: <span id="corrected-power">2.00</span></div>
    <div>Ângulo Calculado: <span id="calculated-angle">89°</span></div>
  </div>

  <div class="wind-buttons left">
    <script>
      for (let i = 1; i <= 26; i++) {
        document.write(`<div class="wind-button red" data-value="-${i}">-${i}</div>`);
      }
    </script>
  </div>
  <div class="wind-buttons right">
    <script>
      for (let i = 1; i <= 26; i++) {
        document.write(`<div class="wind-button green" data-value="${i}">${i}</div>`);
      }
    </script>
    <div class="wind-button gray" data-value="0">0</div>
  </div>

  <div class="ruler" id="ruler"></div>

  <script>
    const ruler = document.getElementById('ruler');
    const bfr = document.getElementById('bfr-fill');
    const windButtons = document.querySelectorAll('.wind-button');
    const mobiles = document.querySelectorAll('.mobile');

    let currentWind = 0;
    let selectedMobile = 'armor';
    let distancePixels = 0;

    const infoMobile = document.getElementById('selected-mobile');
    const infoPower = document.getElementById('corrected-power');
    const infoAngle = document.getElementById('calculated-angle');

    const mobileAdjustments = {
      armor: 0,
      mage: -0.05,
      raon: 0.1,
      asate: 0.05
    };

    mobiles.forEach(mob => {
      mob.addEventListener('click', () => {
        mobiles.forEach(m => m.classList.remove('selected'));
        mob.classList.add('selected');
        selectedMobile = mob.id;
        infoMobile.textContent = mob.title;
        recalculate();
      });
    });

    ruler.addEventListener('mousemove', e => {
      const rect = ruler.getBoundingClientRect();
      const x = e.clientX - rect.left;
      distancePixels = Math.max(0, Math.min(800, x));

      ruler.style.background = `linear-gradient(to right, lightgray ${distancePixels}px, transparent 0%)`;

      recalculate();
    });

    windButtons.forEach(btn => {
      btn.addEventListener('mouseenter', () => {
        windButtons.forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        currentWind = parseInt(btn.dataset.value);
        recalculate();
      });
    });

    function recalculate() {
      const anglePerPixel = 1 / 20;
      let angleOffset = distancePixels * anglePerPixel;
      let angle = 90 - angleOffset;

      let factor = 0.5;
      if (currentWind < 0) factor = 0.6;
      if (currentWind > 0) factor = 0.4;
      if (currentWind === 0) factor = 0;

      angle += currentWind * factor;

      let power = 2 + mobileAdjustments[selectedMobile];
      let powerCorrected = power;

      if (angle < 1 || angle > 89) {
        const newAngle = Math.max(1, Math.min(89, angle));
        let factorProporcional = (90 - newAngle) / (90 - (90 - distancePixels * anglePerPixel));
        powerCorrected = power * factorProporcional;
        powerCorrected = Math.min(4.00, powerCorrected);
        let bfrPercent = Math.min(1, powerCorrected / 4);
        bfr.style.width = `${bfrPercent * 100}%`;
        angle = newAngle;
      } else {
        bfr.style.width = '50%';
      }

      infoAngle.textContent = `${String(angle.toFixed(0)).padStart(2, '0')}°`;
      infoPower.textContent = powerCorrected.toFixed(2);
    }
  </script>
</body>
</html>
